import os
import logging
from datetime import datetime, date, timedelta

from telegram import (
    Update,
    ReplyKeyboardMarkup,
    KeyboardButton,
)
from telegram.ext import (
    ApplicationBuilder,
    CommandHandler,
    MessageHandler,
    ContextTypes,
    filters,
)

logging.basicConfig(
    format="%(asctime)s - %(name)s - %(levelname)s - %(message)s",
    level=logging.INFO,
)
logger = logging.getLogger(__name__)

# –•—Ä–∞–Ω–∏–ª–∏—â–µ –ø—Ä–æ—Ñ–∏–ª–µ–π –≤ –ø–∞–º—è—Ç–∏ (–ø–æ—Ç–æ–º –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –ë–î)
user_profiles = {}


# ---------- –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ----------

def reduce_to_digit(n: int) -> int:
    """–°—É–º–º–∏—Ä—É–µ–º —Ü–∏—Ñ—Ä—ã, –ø–æ–∫–∞ –Ω–µ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è —á–∏—Å–ª–æ 1‚Äì9."""
    while n > 9:
        s = 0
        for ch in str(n):
            if ch.isdigit():
                s += int(ch)
        n = s or n
    # –æ–≥—Ä–∞–Ω–∏—á–∏–º 1‚Äì9 –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π
    return max(1, min(9, n))


def get_day_number(d: date) -> int:
    """–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –¥–Ω—è (–¥–ª—è –≤—Å–µ—Ö)"""
    s = d.day + d.month + d.year
    return reduce_to_digit(s)


def get_life_path(birth: date) -> int:
    """–ë–∞–∑–æ–≤–æ–µ —á–∏—Å–ª–æ –ø—É—Ç–∏ —á–µ–ª–æ–≤–µ–∫–∞ (–ø–æ –¥–∞—Ç–µ —Ä–æ–∂–¥–µ–Ω–∏—è)."""
    s = birth.day + birth.month + birth.year
    return reduce_to_digit(s)


def parse_birthdate(text: str):
    """–ü–∞—Ä—Å–∏–º –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì, –î–î-–ú–ú-–ì–ì–ì–ì –∏–ª–∏ –î–î/–ú–ú/–ì–ì–ì–ì."""
    text = text.strip().replace(" ", "")
    for sep in (".", "-", "/"):
        if sep in text:
            parts = text.split(sep)
            if len(parts) == 3:
                try:
                    d = int(parts[0])
                    m = int(parts[1])
                    y = int(parts[2])
                    return date(y, m, d)
                except Exception:
                    return None
    return None


def get_alignment_phrase(day_n: int, life_n: int or None) -> str:
    """–ú—è–≥–∫–æ–µ –ø–æ—è—Å–Ω–µ–Ω–∏–µ, –∫–∞–∫ —ç–Ω–µ—Ä–≥–∏—è –¥–Ω—è —Å–æ–æ—Ç–Ω–æ—Å–∏—Ç—Å—è —Å –ª–∏—á–Ω—ã–º –ø—É—Ç—ë–º."""
    if life_n is None:
        return ""

    if day_n == life_n:
        return (
            "\n\n–°–µ–≥–æ–¥–Ω—è—à–Ω—è—è —ç–Ω–µ—Ä–≥–∏—è –æ—á–µ–Ω—å –≤ —Ä–µ–∑–æ–Ω–∞–Ω—Å–µ —Å —Ç–≤–æ–∏–º –ª–∏—á–Ω—ã–º –ø—É—Ç—ë–º ‚Äî –¥–µ–Ω—å –æ—â—É—â–∞–µ—Ç—Å—è ¬´—Å–≤–æ–∏–º¬ª."
        )
    if (day_n - life_n) % 3 == 0:
        return (
            "\n\n–≠–Ω–µ—Ä–≥–∏—è –¥–Ω—è –Ω–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç —Ç–≤–æ–µ–π –ø—Ä–∏—Ä–æ–¥–µ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π –µ—ë –∫–∞–∫ –º—è–≥–∫–æ–µ —É—Å–∏–ª–µ–Ω–∏–µ —É–∂–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∫—É—Ä—Å–∞."
        )
    if (day_n, life_n) in ((1, 2), (8, 6), (4, 8)):
        return (
            "\n\n–í–∞–∂–Ω–æ: —ç–Ω–µ—Ä–≥–∏—è –¥–Ω—è —á—É—Ç—å –ø–æ–¥—Ç–∞–ª–∫–∏–≤–∞–µ—Ç –≤—ã–π—Ç–∏ –∑–∞ –ø—Ä–∏–≤—ã—á–Ω—ã–µ —Ä–∞–º–∫–∏. –ó–∞–º–µ—Ç—å, –≥–¥–µ —Ç—ã –æ–±—ã—á–Ω–æ —Ç–æ—Ä–º–æ–∑–∏—à—å —Å–µ–±—è."
        )
    return (
        "\n\n–≠–Ω–µ—Ä–≥–∏—è –¥–Ω—è –∏ —Ç–≤–æ–π –ø—É—Ç—å —Å–µ–≥–æ–¥–Ω—è –Ω–µ–º–Ω–æ–≥–æ ¬´—Å–ø–æ—Ä—è—Ç¬ª ‚Äî –æ—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–æ –≤—ã–±–∏—Ä–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ, –∞ –Ω–µ –Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–µ."
    )


# ---------- –¢–ï–ö–°–¢–´ –ü–†–û–ì–ù–û–ó–û–í ----------

def get_general_forecast(d: date, life_n: int or None = None) -> str:
    n = get_day_number(d)
    base = f"üîÆ *–û–±—â–∏–π –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ {d.strftime('%d.%m.%Y')}*\n\n"

    if n == 1:
        body = (
            "–î–µ–Ω—å –ª–∏–¥–µ—Ä—Å—Ç–≤–∞ –∏ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã. –•–æ—Ä–æ—à–µ–µ –≤—Ä–µ–º—è, —á—Ç–æ–±—ã –∑–∞–¥–∞—Ç—å —Ç–æ–Ω, "
            "–¥–µ–ª–∞—Ç—å –ø–µ—Ä–≤—ã–µ —à–∞–≥–∏ –∏ –Ω–µ –∂–¥–∞—Ç—å —á—É–∂–æ–≥–æ –æ–¥–æ–±—Ä–µ–Ω–∏—è.\n\n"
            "–°—Ñ–æ–∫—É—Å–∏—Ä—É–π—Å—è –Ω–∞ —Ç–æ–º, —á—Ç–æ –≤–∞–∂–Ω–æ –∏–º–µ–Ω–Ω–æ —Ç–µ–±–µ, –∞ –Ω–µ –≤—Å–µ–º –ø–æ–¥—Ä—è–¥."
        )
    elif n == 2:
        body = (
            "–î–µ–Ω—å –º—è–≥–∫–∏—Ö —Å–æ—é–∑–æ–≤ –∏ –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–µ–π. –ì–ª–∞–≤–Ω–æ–µ —Å–ª–æ–≤–æ –¥–Ω—è ‚Äî *–±–∞–ª–∞–Ω—Å*.\n\n"
            "–•–æ—Ä–æ—à–æ –æ–±—Å—É–∂–¥–∞—Ç—å, —Å–ª—É—à–∞—Ç—å, –∏—Å–∫–∞—Ç—å –æ–±—â–∏–π —è–∑—ã–∫. –î–∞–≤–ª–µ–Ω–∏–µ –∏ —É–ª—å—Ç–∏–º–∞—Ç—É–º—ã —Å–µ–≥–æ–¥–Ω—è –±—É–¥—É—Ç –¥–∞–≤–∞—Ç—å –º–µ–Ω—å—à–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞, —á–µ–º —Å–ø–æ–∫–æ–π–Ω—ã–π –¥–∏–∞–ª–æ–≥."
        )
    elif n == 3:
        body = (
            "–î–µ–Ω—å –∏–¥–µ–π, –æ–±—â–µ–Ω–∏—è –∏ –∂–∏–≤—ã—Ö —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤. –•–æ—Ä–æ—à–µ–µ –≤—Ä–µ–º—è –¥–ª—è —Å—ä—ë–º–æ–∫, –ø–µ—Ä–µ–ø–∏—Å–æ–∫, –º–æ–∑–≥–æ—à—Ç—É—Ä–º–æ–≤.\n\n"
            "–ù–µ –¥–µ—Ä–∂–∏ –º—ã—Å–ª–∏ –≤ —Å–µ–±–µ ‚Äî –∑–∞–ø–∏—Å—ã–≤–∞–π –∏ –ø—Ä–æ–≥–æ–≤–∞—Ä–∏–≤–∞–π –≤—Å–ª—É—Ö, —Ç–∞–∫ –±—ã—Å—Ç—Ä–µ–µ –ø—Ä–∏–¥—ë—Ç —è—Å–Ω–æ—Å—Ç—å."
        )
    elif n == 4:
        body = (
            "–î–µ–Ω—å —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ —Å–∏—Å—Ç–µ–º—ã. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø–ª–∞–Ω–æ–≤, —É—á—ë—Ç–∞, —Ç–∞–±–ª–∏—Ü, –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.\n\n"
            "–ï—Å–ª–∏ —Å–µ–≥–æ–¥–Ω—è —Ä–∞–∑–ª–æ–∂–∏—à—å –≤—Å—ë –ø–æ –ø–æ–ª–æ—á–∫–∞–º, –¥–∞–ª—å—à–µ —Å—Ç–∞–Ω–µ—Ç –≥–æ—Ä–∞–∑–¥–æ –ª–µ–≥—á–µ –¥—ã—à–∞—Ç—å –∏ –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è."
        )
    elif n == 5:
        body = (
            "–î–µ–Ω—å –ø–µ—Ä–µ–º–µ–Ω –∏ –≥–∏–±–∫–æ—Å—Ç–∏. –ü–ª–∞–Ω—ã –º–æ–≥—É—Ç —Å–¥–≤–∏–≥–∞—Ç—å—Å—è, –ª—é–¥–∏ ‚Äî –º–µ–Ω—è—Ç—å —Ä–µ—à–µ–Ω–∏—è.\n\n"
            "–ù–µ —Ü–µ–ø–ª—è–π—Å—è –∑–∞ –∂—ë—Å—Ç–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π: –ª–µ–≥—á–µ –≤—ã–∏–≥—Ä–∞–µ—Ç —Ç–æ—Ç, –∫—Ç–æ —É–º–µ–µ—Ç –ø–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞—Ç—å—Å—è –ø–æ —Ö–æ–¥—É."
        )
    elif n == 6:
        body = (
            "–î–µ–Ω—å –ø—Ä–æ –¥–æ–º, —É—é—Ç –∏ –±–ª–∏–∑–∫–∏—Ö –ª—é–¥–µ–π. –•–æ—Ä–æ—à–æ —Å–æ–≤–º–µ—â–∞—Ç—å —Ä–∞–±–æ—á–∏–µ –∑–∞–¥–∞—á–∏ —Å –∑–∞–±–æ—Ç–æ–π –æ —Å–µ–±–µ –∏ —Å–µ–º—å–µ.\n\n"
            "–ö—Ä–∞—Å–æ—Ç–∞ –≤–æ–∫—Ä—É–≥ –∏ –º–∞–ª–µ–Ω—å–∫–∏–µ —Ä–∏—Ç—É–∞–ª—ã –∫–æ–º—Ñ–æ—Ä—Ç–∞ —Å–µ–≥–æ–¥–Ω—è —Ä–∞–±–æ—Ç–∞—é—Ç –ª—É—á—à–µ –ª—é–±–æ–π –º–æ—Ç–∏–≤–∞—Ü–∏–∏."
        )
    elif n == 7:
        body = (
            "–î–µ–Ω—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –≥–ª—É–±–∏–Ω—ã –∏ –Ω–∞–±–ª—é–¥–µ–Ω–∏–π. –í–∞–∂–Ω–µ–µ –¥—É–º–∞—Ç—å –∏ —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å, —á–µ–º –±–µ–∂–∞—Ç—å –∏ —É—Å–ø–µ–≤–∞—Ç—å.\n\n"
            "–ü–æ–ª–µ–∑–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è, –∑–∞–¥–∞—Ç—å —Å–µ–±–µ –ø–∞—Ä—É —á–µ—Å—Ç–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ —É—Å–ª—ã—à–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã."
        )
    elif n == 8:
        body = (
            "–î–µ–Ω—å —Å–∏–ª—ã, –¥–µ–Ω–µ–≥ –∏ —Ä–µ—à–µ–Ω–∏–π. –•–æ—Ä–æ—à–∏–π –º–æ–º–µ–Ω—Ç, —á—Ç–æ–±—ã –≥–æ–≤–æ—Ä–∏—Ç—å –æ –¥–µ–Ω—å–≥–∞—Ö, –ø–µ—Ä–µ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Ü–µ–Ω—ã –∏ —É—Å–ª–æ–≤–∏—è.\n\n"
            "–í–∞–∂–Ω–æ –¥–µ—Ä–∂–∞—Ç—å –æ—Å–∞–Ω–∫—É ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –∏ –≤–Ω–µ—à–Ω—é—é. –°–µ–≥–æ–¥–Ω—è —Ç–µ–±—è —Å–ª—ã—à–∞—Ç, –∫–æ–≥–¥–∞ —Ç—ã —É–≤–µ—Ä–µ–Ω–∞ –≤ —Å–µ–±–µ."
        )
    else:  # 9
        body = (
            "–î–µ–Ω—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏–π –∏ –ª—ë–≥–∫–æ–π —É–±–æ—Ä–∫–∏ –≤ –¥–µ–ª–∞—Ö –∏ –≥–æ–ª–æ–≤–µ.\n\n"
            "–•–æ—Ä–æ—à–æ –∑–∞–∫—Ä—ã–≤–∞—Ç—å —Ö–≤–æ—Å—Ç—ã, –ø–æ–¥–≤–æ–¥–∏—Ç—å –∏—Ç–æ–≥–∏, —Ä–∞—Å—Å—Ç–∞–≤–∞—Ç—å—Å—è —Å —Ç–µ–º, —á—Ç–æ —É–∂–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∏ –æ—Å–≤–æ–±–æ–∂–¥–∞—Ç—å –º–µ—Å—Ç–æ –ø–æ–¥ –Ω–æ–≤–æ–µ."
        )

    return base + body + get_alignment_phrase(n, life_n)


def get_love_forecast(d: date, life_n: int or None = None) -> str:
    n = get_day_number(d)
    base = f"‚ù§Ô∏è *–û—Ç–Ω–æ—à–µ–Ω–∏—è —Å–µ–≥–æ–¥–Ω—è ({d.strftime('%d.%m.%Y')})*\n\n"

    if n == 1:
        body = (
            "–°–µ–≥–æ–¥–Ω—è –≤–∞–∂–Ω–æ —á–µ—Å—Ç–Ω–æ –æ–±–æ–∑–Ω–∞—á–∞—Ç—å —Å–≤–æ–∏ –∂–µ–ª–∞–Ω–∏—è –∏ –≥—Ä–∞–Ω–∏—Ü—ã. "
            "–ù–µ –∂–¥–∞—Ç—å, —á—Ç–æ –ø–∞—Ä—Ç–Ω—ë—Ä —Å–∞–º –¥–æ–≥–∞–¥–∞–µ—Ç—Å—è.\n\n"
            "–•–æ—Ä–æ—à–∏–π –¥–µ–Ω—å, —á—Ç–æ–±—ã —Å–∫–∞–∑–∞—Ç—å ¬´—è —Ö–æ—á—É¬ª –±–µ–∑ —á—É–≤—Å—Ç–≤–∞ –≤–∏–Ω—ã."
        )
    elif n == 2:
        body = (
            "–î–µ–Ω—å –ø—Ä–æ –¥–∏–∞–ª–æ–≥ –∏ —Å–ª—ã—à–∞–Ω–∏–µ –¥—Ä—É–≥ –¥—Ä—É–≥–∞.\n\n"
            "–ï—Å–ª–∏ –µ—Å—Ç—å —Ç–æ–Ω–∫–∏–µ —Ç–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –∏–∑–±–µ–≥–∞–ª–∏, –º–æ–∂–Ω–æ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ –∫ –Ω–∏–º –ø–æ–¥–æ–π—Ç–∏ ‚Äî –º—è–≥–∫–æ, –±–µ–∑ –ø—Ä–µ—Ç–µ–Ω–∑–∏–π, –∏–∑ –ø–æ–∑–∏—Ü–∏–∏ ¬´—è —á—É–≤—Å—Ç–≤—É—é¬ª."
        )
    elif n == 3:
        body = (
            "–î–æ–±–∞–≤—å –ª—ë–≥–∫–æ—Å—Ç–∏ –∏ –∏–≥—Ä—ã –≤ –æ–±—â–µ–Ω–∏–µ. –®—É—Ç–∫–∏, —Ñ–ª–∏—Ä—Ç, –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç—ã, –Ω–µ–±–æ–ª—å—à–∏–µ —Å—é—Ä–ø—Ä–∏–∑—ã ‚Äî —ç—Ç–æ –≤—Å—ë —Å–µ–≥–æ–¥–Ω—è —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Å–±–ª–∏–∂–µ–Ω–∏–µ.\n\n"
            "–ù–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞–π —Ä–∞–∑–≥–æ–≤–æ—Ä—ã —Ç—è–∂—ë–ª—ã–º–∏ —Ç–µ–º–∞–º–∏."
        )
    elif n == 4:
        body = (
            "–•–æ—Ä–æ—à–∏–π –¥–µ–Ω—å, —á—Ç–æ–±—ã –æ–±—Å—É–¥–∏—Ç—å –±—ã—Ç–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏ –¥–æ–≥–æ–≤–æ—Ä–∏—Ç—å—Å—è –æ –ø—Ä–∞–≤–∏–ª–∞—Ö –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ —Ä–æ–ª–µ–π.\n\n"
            "–ì–ª–∞–≤–Ω–æ–µ ‚Äî –Ω–µ –ø—Ä–µ–≤—Ä–∞—â–∞—Ç—å —Ä–∞–∑–≥–æ–≤–æ—Ä –≤ –¥–æ–ø—Ä–æ—Å, –∞ –≥–æ–≤–æ—Ä–∏—Ç—å –∫–∞–∫ –ø–∞—Ä—Ç–Ω—ë—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å—Ç—Ä–æ—è—Ç –æ–±—â–∏–π –¥–æ–º."
        )
    elif n == 5:
        body = (
            "–ú–æ–∂–µ—Ç —Ç—è–Ω—É—Ç—å –Ω–∞ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –ø–æ—Å—Ç—É–ø–∫–∏ –∏ —Å–º–µ–Ω—É —Å—Ü–µ–Ω–∞—Ä–∏—è. –ï—Å–ª–∏ —Ö–æ—á–µ—Ç—Å—è —Å–≤–µ–∂–µ—Å—Ç–∏ ‚Äî —Å–¥–µ–ª–∞–π —á—Ç–æ-—Ç–æ –≤–º–µ—Å—Ç–µ –Ω–µ –∫–∞–∫ –æ–±—ã—á–Ω–æ.\n\n"
            "–ù–æ –Ω–µ —Ä—É–±–∏ —Å –ø–ª–µ—á–∞, –µ—Å–ª–∏ —ç–º–æ—Ü–∏–∏ —Å–∫–∞—á—É—Ç."
        )
    elif n == 6:
        body = (
            "–¢—ë–ø–ª—ã–π –¥–µ–Ω—å –¥–ª—è —Å–µ–º–µ–π–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏, –æ–±—ä—è—Ç–∏–π, —Å–æ–≤–º–µ—Å—Ç–Ω—ã—Ö —É–∂–∏–Ω–æ–≤ –∏ –∑–∞–±–æ—Ç—ã.\n\n"
            "–ï—Å–ª–∏ —Ç—ã –≤ –ø–æ–∏—Å–∫–µ ‚Äî –±—É–¥—å —Ç–∞–º, –≥–¥–µ —Ç–µ–±–µ –∏—Å–∫—Ä–µ–Ω–Ω–µ —Ö–æ—Ä–æ—à–æ, –∞ –Ω–µ –≥–¥–µ ¬´–Ω–∞–¥–æ —Å–≤–µ—Ç–∏—Ç—å—Å—è¬ª."
        )
    elif n == 7:
        body = (
            "–ú–æ–∂–Ω–æ –∑–∞—Ö–æ—Ç–µ—Ç—å —á—É—Ç—å –±–æ–ª—å—à–µ –ª–∏—á–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞. –≠—Ç–æ –Ω–µ –ø—Ä–æ –æ—Ö–ª–∞–¥–µ–≤–∞–Ω–∏–µ, –∞ –ø—Ä–æ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–≤–∞—Ä–∏—Ç—å —ç–º–æ—Ü–∏–∏.\n\n"
            "–û–±–æ–∑–Ω–∞—á—å —ç—Ç–æ —Å–ø–æ–∫–æ–π–Ω–æ –∏ –±–µ–∑ –æ–±–≤–∏–Ω–µ–Ω–∏–π, —á—Ç–æ–±—ã –ø–∞—Ä—Ç–Ω—ë—Ä –Ω–µ –¥–æ–¥—É–º—ã–≤–∞–ª –ª–∏—à–Ω–µ–≥–æ."
        )
    elif n == 8:
        body = (
            "–¢–µ–º–∞ –¥–µ–Ω–µ–≥ –∏ —Å—Ç–∞—Ç—É—Å–∞ –º–æ–∂–µ—Ç –ø—Ä–æ—è–≤–ª—è—Ç—å—Å—è —Å–∏–ª—å–Ω–µ–µ –æ–±—ã—á–Ω–æ–≥–æ.\n\n"
            "–ï—Å–ª–∏ –æ–±—Å—É–∂–¥–∞–µ—Ç–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã ‚Äî –≥–æ–≤–æ—Ä–∏—Ç–µ –ø—Ä–æ ¬´–º—ã¬ª, –∞ –Ω–µ ¬´—Ç—ã –¥–æ–ª–∂–µ–Ω / —Ç—ã –æ–±—è–∑–∞–Ω–∞¬ª."
        )
    else:  # 9
        body = (
            "–•–æ—Ä–æ—à–∏–π –¥–µ–Ω—å, —á—Ç–æ–±—ã –æ—Ç–ø—É—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –æ–±–∏–¥—ã, –æ–∂–∏–¥–∞–Ω–∏—è –∏ —Å—Ü–µ–Ω–∞—Ä–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –±–æ–ª—å—à–µ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç.\n\n"
            "–≠—Ç–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ —Ä–∞—Å—Å—Ç–∞–≤–∞–Ω–∏—è. –ò–Ω–æ–≥–¥–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–µ—Ä–µ—Å—Ç–∞—Ç—å –∂–¥–∞—Ç—å –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ–≥–æ –∏ –ø–æ–∑–≤–æ–ª–∏—Ç—å —Å–µ–±–µ –ø–æ-–Ω–æ–≤–æ–º—É —Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏—è."
        )

    return base + body + get_alignment_phrase(n, life_n)


def get_money_forecast(d: date, life_n: int or None = None) -> str:
    n = get_day_number(d)
    base = f"üí∞ *–î–µ–Ω—å–≥–∏ –∏ –¥–µ–ª–∞ ({d.strftime('%d.%m.%Y')})*\n\n"

    if n == 1:
        body = (
            "–•–æ—Ä–æ—à–∏–π –¥–µ–Ω—å –¥–ª—è –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤: –Ω–æ–≤—ã–µ –ø—Ä–æ–µ–∫—Ç—ã, –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, –ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã, –≥–¥–µ —Ç—ã –∑–∞–¥–∞—ë—à—å –ø—Ä–∞–≤–∏–ª–∞.\n\n"
            "–ù–µ –∑–∞–Ω–∏–∂–∞–π —á–µ–∫ —Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–º—É, —á—Ç–æ ¬´—Ç–∞–∫ —Å–ø–æ–∫–æ–π–Ω–µ–µ¬ª."
        )
    elif n == 2:
        body = (
            "–§–æ–∫—É—Å –Ω–∞ –ø–∞—Ä—Ç–Ω—ë—Ä—Å—Ç–≤–∞—Ö. –î–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏, –∫–æ–ª–ª–∞–±–æ—Ä–∞—Ü–∏–∏, —Å–æ–≤–º–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã –º–æ–≥—É—Ç –¥–≤–∏–≥–∞—Ç—å—Å—è –ª–µ–≥—á–µ.\n\n"
            "–ò–∑–±–µ–≥–∞–π –ø–∞—Å—Å–∏–≤–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ ¬´–∫–∞–∫ —Å–∫–∞–∂–µ—Ç–µ¬ª ‚Äî —Ç–≤–æ–π –≥–æ–ª–æ—Å —Ç–æ–∂–µ –≤–∞–∂–µ–Ω."
        )
    elif n == 3:
        body = (
            "–î–µ–Ω—å –¥–ª—è –∏–¥–µ–π –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞. –í–∞–∂–Ω—ã–µ –º—ã—Å–ª–∏ –º–æ–≥—É—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –æ–±—â–µ–Ω–∏—è, —Å—ä—ë–º–æ–∫, –æ–±—Å—É–∂–¥–µ–Ω–∏–π.\n\n"
            "–ó–∞–ø–∏—Å—ã–≤–∞–π, –Ω–µ –¥–æ–≤–µ—Ä—è–π —Ç–æ–ª—å–∫–æ –ø–∞–º—è—Ç–∏."
        )
    elif n == 4:
        body = (
            "–í—Ä–µ–º—è –¥–ª—è —É—á—ë—Ç–∞, —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ —Å–∏—Å—Ç–µ–º. –¢–∞–±–ª–∏—Ü—ã, –æ—Ç—á—ë—Ç—ã, —Ñ–∏–Ω–ø–ª–∞–Ω—ã, —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥—É—à–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.\n\n"
            "–î–∞–∂–µ –æ–¥–∏–Ω —á–∞—Å —Å–µ–≥–æ–¥–Ω—è, –≤–ª–æ–∂–µ–Ω–Ω—ã–π –≤ –ø–æ—Ä—è–¥–æ–∫ –≤ –¥–µ–Ω—å–≥–∞—Ö, —Å–∏–ª—å–Ω–æ —Å–Ω–∏–∑–∏—Ç —Ñ–æ–Ω —Ç—Ä–µ–≤–æ–≥–∏."
        )
    elif n == 5:
        body = (
            "–ú–æ–≥—É—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ ‚Äî –∏ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ —Ç—Ä–∞—Ç—ã.\n\n"
            "–ü–µ—Ä–µ–¥ —Å–ø–æ–Ω—Ç–∞–Ω–Ω—ã–º–∏ –ø–æ–∫—É–ø–∫–∞–º–∏ –∑–∞–¥–∞–≤–∞–π –≤–æ–ø—Ä–æ—Å: ¬´–≠—Ç–æ –ø—Ä–æ –º–æ—é —Ü–µ–ª—å –∏–ª–∏ –ø—Ä–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ?¬ª"
        )
    elif n == 6:
        body = (
            "–î–µ–Ω—å, –∫–æ–≥–¥–∞ –º–æ–∂–Ω–æ –ø–æ–¥—É–º–∞—Ç—å –æ –¥–µ–Ω—å–≥–∞—Ö –∫–∞–∫ –æ —Ä–µ—Å—É—Ä—Å–µ –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–∞ –∂–∏–∑–Ω–∏: –¥–æ–º–∞, –±—ã—Ç–∞, –∑–¥–æ—Ä–æ–≤—å—è.\n\n"
            "–•–æ—Ä–æ—à–æ –∑–∞—Ö–æ–¥—è—Ç –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–π –∫–æ–º—Ñ–æ—Ä—Ç, –∞ –Ω–µ –≤ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ –∏–º–ø—É–ª—å—Å—ã."
        )
    elif n == 7:
        body = (
            "–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞: —á—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –ø—Ä–∏–Ω–æ—Å–∏—Ç –¥–µ–Ω—å–≥–∏, –∞ —á—Ç–æ –ø—Ä–æ—Å—Ç–æ –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Ä–µ–º—è.\n\n"
            "–°–º–æ—Ç—Ä–∏ –Ω–∞ —Ü–∏—Ñ—Ä—ã —á–µ—Å—Ç–Ω–æ, –±–µ–∑ —É–∫—Ä–∞—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞. –¢–∞–º —É–∂–µ –µ—Å—Ç—å –æ—Ç–≤–µ—Ç—ã."
        )
    elif n == 8:
        body = (
            "–°–∏–ª—å–Ω—ã–π –¥–µ–Ω–µ–∂–Ω—ã–π –¥–µ–Ω—å. –ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã, –ø–æ–≤—ã—à–µ–Ω–∏–µ —Ü–µ–Ω, –ø–µ—Ä–µ—Å–º–æ—Ç—Ä —É—Å–ª–æ–≤–∏–π ‚Äî –≤—Å—ë —ç—Ç–æ –º–æ–∂–µ—Ç –∑–∞–π—Ç–∏ –æ—Å–æ–±–µ–Ω–Ω–æ —Ö–æ—Ä–æ—à–æ.\n\n"
            "–í–∞–∂–Ω–æ –Ω–µ –∏–≥—Ä–∞—Ç—å –≤ ¬´–º–∞–ª–µ–Ω—å–∫—É—é –¥–µ–≤–æ—á–∫—É¬ª, –∫–æ—Ç–æ—Ä–∞—è –±–æ–∏—Ç—Å—è –Ω–∞–∑–≤–∞—Ç—å —Å–≤–æ—é —Ä–µ–∞–ª—å–Ω—É—é —Ü–µ–Ω–Ω–æ—Å—Ç—å."
        )
    else:  # 9
        body = (
            "–í—Ä–µ–º—è –∑–∞–∫—Ä—ã–≤–∞—Ç—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ö–≤–æ—Å—Ç—ã: –¥–æ–ª–≥–∏, –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã–µ —Å—á–µ—Ç–∞, –Ω–µ–¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏.\n\n"
            "–û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ —Å–æ–∑–¥–∞—ë—Ç –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–π."
        )

    return base + body + get_alignment_phrase(n, life_n)


def get_advice(d: date, life_n: int or None = None) -> str:
    n = get_day_number(d)
    base = f"üí° *–°–æ–≤–µ—Ç –¥–Ω—è ({d.strftime('%d.%m.%Y')})*\n\n"

    mapping = {
        1: "–°–¥–µ–ª–∞–π –æ–¥–∏–Ω —à–∞–≥, –æ—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ —Ç–µ–±–µ —á—É—Ç—å-—á—É—Ç—å —Å—Ç—Ä–∞—à–Ω–æ–≤–∞—Ç–æ, –Ω–æ –∫–æ—Ç–æ—Ä—ã–π –¥–∞–≤–Ω–æ –Ω–∞–∑—Ä–µ–ª.",
        2: "–ü–æ–ø—Ä–æ–±—É–π —Å–µ–≥–æ–¥–Ω—è –Ω–µ —Å–ø–æ—Ä–∏—Ç—å, –∞ –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –∏ —Å–ª—ã—à–∞—Ç—å –æ—Ç–≤–µ—Ç—ã.",
        3: "–°–∫–∞–∂–∏ –≤—Å–ª—É—Ö —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –≤–∞–∂–Ω—É—é –º—ã—Å–ª—å, –∫–æ—Ç–æ—Ä—É—é –æ–±—ã—á–Ω–æ –ø—Ä—è—á–µ—à—å.",
        4: "–í—ã–±–µ—Ä–∏ –æ–¥–Ω—É –∑–æ–Ω—É —Ö–∞–æ—Å–∞ –∏ –Ω–∞–≤–µ–¥–∏ —Ç–∞–º –ø–æ—Ä—è–¥–æ–∫ ‚Äî –ø—É—Å—Ç—å –Ω–µ–±–æ–ª—å—à–æ–π, –Ω–æ –¥–æ –∫–æ–Ω—Ü–∞.",
        5: "–ë—É–¥—å –æ—Ç–∫—Ä—ã—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º, –Ω–æ –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–π —Ä–µ—à–µ–Ω–∏–π –∏–∑ —É—Å—Ç–∞–ª–æ—Å—Ç–∏ –∏ —Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–∏—è.",
        6: "–°–¥–µ–ª–∞–π —á—Ç–æ-—Ç–æ –º–∞–ª–µ–Ω—å–∫–æ–µ –∏ —Ç—ë–ø–ª–æ–µ –¥–ª—è —Å–µ–±—è –∏ –¥–ª—è —Ç–æ–≥–æ, –∫—Ç–æ —Ç–µ–±–µ –¥–æ—Ä–æ–≥.",
        7: "–ù–∞–π–¥–∏ —Ö–æ—Ç—è –±—ã 15 –º–∏–Ω—É—Ç —Ç–∏—à–∏–Ω—ã –±–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏ –≤–Ω–µ—à–Ω–µ–≥–æ —à—É–º–∞.",
        8: "–°–¥–µ–ª–∞–π –æ–¥–Ω–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –¥–ª—è —É—Å–∏–ª–µ–Ω–∏—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –ø–æ—Ç–æ–∫–∞.",
        9: "–û—Ç–ø—É—Å—Ç–∏ —Ç–æ, —á—Ç–æ –¥–∞–≤–Ω–æ –ø–µ—Ä–µ—Å—Ç–∞–ª–æ —Ä–∞–±–æ—Ç–∞—Ç—å, –¥–∞–∂–µ –µ—Å–ª–∏ –∫ —ç—Ç–æ–º—É –µ—Å—Ç—å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å.",
    }

    body = mapping.get(
        n,
        "–ü—Ä–∏—Å–ª—É—à–∞–π—Å—è –∫ —Å–µ–±–µ ‚Äî —Å–µ–≥–æ–¥–Ω—è —Ç–≤–æ–∏ –æ—â—É—â–µ–Ω–∏—è –±—É–¥—É—Ç —Ç–æ—á–Ω–µ–µ –ª—é–±—ã—Ö —Å–æ–≤–µ—Ç–æ–≤.",
    )

    return base + body + get_alignment_phrase(n, life_n)


def get_energy(d: date, life_n: int or None = None) -> str:
    n = get_day_number(d)
    base = f"‚ú® *–≠–Ω–µ—Ä–≥–∏—è –¥–Ω—è ({d.strftime('%d.%m.%Y')})*\n\n"

    if n == 1:
        body = "–ê—Ä—Ö–µ—Ç–∏–ø –¥–Ω—è ‚Äî –õ–∏–¥–µ—Ä. –í–Ω—É—Ç—Ä–∏ –º–Ω–æ–≥–æ –∏–º–ø—É–ª—å—Å–∞ ¬´—Å–∞–º–∞ —Ä–µ—à—É, —Å–∞–º–∞ —Å–ø—Ä–∞–≤–ª—é—Å—å¬ª. –í–∞–∂–Ω–æ –Ω–µ –ø—Ä–µ–≤—Ä–∞—â–∞—Ç—å —ç—Ç–æ –≤ –∏–∑–æ–ª—è—Ü–∏—é."
    elif n == 2:
        body = "–ê—Ä—Ö–µ—Ç–∏–ø –¥–Ω—è ‚Äî –ü–∞—Ä—Ç–Ω—ë—Ä. –ú–∏—Ä –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã –º—è–≥—á–µ, –∫–æ–≥–¥–∞ —Ç—ã –Ω–µ –æ–¥–Ω–∞ –ø—Ä–æ—Ç–∏–≤ –≤—Å–µ—Ö, –∞ –≤–º–µ—Å—Ç–µ —Å –∫–µ–º-—Ç–æ."
    elif n == 3:
        body = "–ê—Ä—Ö–µ—Ç–∏–ø –¥–Ω—è ‚Äî –ú—É–∑–∞. –≠–Ω–µ—Ä–≥–∏—è –∏–¥–µ–π, —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞ –∏ –æ–±—â–µ–Ω–∏—è. –•–æ—Ä–æ—à–µ–µ –≤—Ä–µ–º—è, —á—Ç–æ–±—ã –±—ã—Ç—å –Ω–∞ –≤–∏–¥—É."
    elif n == 4:
        body = "–ê—Ä—Ö–µ—Ç–∏–ø –¥–Ω—è ‚Äî –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä. –¢–∏—Ö–∞—è, –Ω–æ —Å–∏–ª—å–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è –Ω–∞–≤–µ–¥–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏—è –æ–ø–æ—Ä—ã."
    elif n == 5:
        body = "–ê—Ä—Ö–µ—Ç–∏–ø –¥–Ω—è ‚Äî –ü—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫. –ú–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è, —Å–º–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π –∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤. –ì–∏–±–∫–æ—Å—Ç—å ‚Äî —Å—É–ø–µ—Ä—Å–∏–ª–∞."
    elif n == 6:
        body = "–ê—Ä—Ö–µ—Ç–∏–ø –¥–Ω—è ‚Äî –•—Ä–∞–Ω–∏—Ç–µ–ª—å–Ω–∏—Ü–∞ –î–æ–º–∞. –≠–Ω–µ—Ä–≥–∏—è –∑–∞–±–æ—Ç—ã, —É—é—Ç–∞ –∏ –≥–∞—Ä–º–æ–Ω–∏–∏ –æ—Ç–Ω–æ—à–µ–Ω–∏–π."
    elif n == 7:
        body = "–ê—Ä—Ö–µ—Ç–∏–ø –¥–Ω—è ‚Äî –ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å. –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –≥–ª—É–±–∏–Ω–∞, –∏–Ω—Ç—É–∏—Ü–∏—è –∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ —Å–º—ã—Å–ª–∞—Ö –≤–∫–ª—é—á–µ–Ω—ã —Å–∏–ª—å–Ω–µ–µ –æ–±—ã—á–Ω–æ–≥–æ."
    elif n == 8:
        body = "–ê—Ä—Ö–µ—Ç–∏–ø –¥–Ω—è ‚Äî –í–ª–∞–¥–µ–ª–∏—Ü–∞ –†–µ—Å—É—Ä—Å–æ–≤. –≠–Ω–µ—Ä–≥–∏—è –≤–ª–∞—Å—Ç–∏, –¥–µ–Ω–µ–≥, –≤–ª–∏—è–Ω–∏—è. –í–∞–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å –ø—Ä–æ —ç–∫–æ–ª–æ–≥–∏—á–Ω–æ—Å—Ç—å —Ä–µ—à–µ–Ω–∏–π."
    else:  # 9
        body = "–ê—Ä—Ö–µ—Ç–∏–ø –¥–Ω—è ‚Äî –ó–∞–≤–µ—Ä—à–∏—Ç–µ–ª—å–Ω–∏—Ü–∞. –≠–Ω–µ—Ä–≥–∏—è –º—è–≥–∫–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è —Ü–∏–∫–ª–æ–≤ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å."

    return base + body + get_alignment_phrase(n, life_n)


def get_week_overview(start_date: date, life_n: int or None = None) -> str:
    base = "üìÖ *–ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ –±–ª–∏–∂–∞–π—à—É—é –Ω–µ–¥–µ–ª—é*\n\n"
    parts = [base]
    today = start_date

    for i in range(7):
        d = today + timedelta(days=i)
        n = get_day_number(d)
        day_name = d.strftime("%A")
        day_name_ru = {
            "Monday": "–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫",
            "Tuesday": "–í—Ç–æ—Ä–Ω–∏–∫",
            "Wednesday": "–°—Ä–µ–¥–∞",
            "Thursday": "–ß–µ—Ç–≤–µ—Ä–≥",
            "Friday": "–ü—è—Ç–Ω–∏—Ü–∞",
            "Saturday": "–°—É–±–±–æ—Ç–∞",
            "Sunday": "–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ",
        }.get(day_name, day_name)

        if n == 1:
            short = "–î–µ–Ω—å –¥–ª—è —Å—Ç–∞—Ä—Ç–æ–≤ –∏ —Å–º–µ–ª—ã—Ö —à–∞–≥–æ–≤."
        elif n == 2:
            short = "–î–µ–Ω—å –º—è–≥–∫–∏—Ö –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–µ–π –∏ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–∞."
        elif n == 3:
            short = "–î–µ–Ω—å –æ–±—â–µ–Ω–∏—è, –∏–¥–µ–π –∏ –ø—Ä–æ—è–≤–ª–µ–Ω–Ω–æ—Å—Ç–∏."
        elif n == 4:
            short = "–î–µ–Ω—å —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –ø–æ—Ä—è–¥–∫–∞ –∏ —Ñ–æ–∫—É—Å–∞."
        elif n == 5:
            short = "–î–µ–Ω—å –ø–µ—Ä–µ–º–µ–Ω, –ø–æ–µ–∑–¥–æ–∫ –∏ –≥–∏–±–∫–æ—Å—Ç–∏."
        elif n == 6:
            short = "–î–µ–Ω—å –¥–æ–º–∞, –±–ª–∏–∑–∫–∏—Ö –∏ –≥–∞—Ä–º–æ–Ω–∏–∏."
        elif n == 7:
            short = "–î–µ–Ω—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –≥–ª—É–±–∏–Ω—ã –∏ –Ω–∞–±–ª—é–¥–µ–Ω–∏–π."
        elif n == 8:
            short = "–î–µ–Ω—å –¥–µ–Ω–µ–≥, —Ä–µ—à–µ–Ω–∏–π –∏ –≤–ª–∏—è–Ω–∏—è."
        else:
            short = "–î–µ–Ω—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏–π –∏ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞."

        parts.append(f"*{day_name_ru}, {d.strftime('%d.%m')}* ‚Äî {short}")

    # –ü–æ–∫–∞ –Ω–µ–¥–µ–ª—è –æ—Å—Ç–∞—ë—Ç—Å—è –±–æ–ª–µ–µ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π, –º–æ–∂–Ω–æ –ø–æ–∑–∂–µ –¥–æ–±–∞–≤–∏—Ç—å —Ö–≤–æ—Å—Ç —Å —É—á—ë—Ç–æ–º –ø—É—Ç–∏
    if life_n is not None:
        parts.append(
            "\n–õ–∏—á–Ω—ã–π –æ—Ç—Ç–µ–Ω–æ–∫ –Ω–µ–¥–µ–ª–∏: —Å–º–æ—Ç—Ä–∏ –Ω–∞ —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ –ø—Ä–∏–∑–º—É —Å–≤–æ–µ–≥–æ –ø—É—Ç–∏ ‚Äî —á–∞—Å—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ—Ç —Ç–≤–æ–∏ –∫–ª—é—á–µ–≤—ã–µ –∑–∞–¥–∞—á–∏."
        )

    return "\n".join(parts)


# ---------- –ö–õ–ê–í–ò–ê–¢–£–†–ê ----------

def main_keyboard() -> ReplyKeyboardMarkup:
    buttons = [
        [KeyboardButton("üîÆ –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è"), KeyboardButton("üìÖ –ù–µ–¥–µ–ª—è")],
        [KeyboardButton("‚ù§Ô∏è –õ—é–±–æ–≤—å"), KeyboardButton("üí∞ –î–µ–Ω—å–≥–∏")],
        [KeyboardButton("üí° –°–æ–≤–µ—Ç"), KeyboardButton("‚ú® –≠–Ω–µ—Ä–≥–∏—è –¥–Ω—è")],
    ]
    return ReplyKeyboardMarkup(buttons, resize_keyboard=True)


# ---------- –•–ï–ù–î–õ–ï–†–´ –ö–û–ú–ê–ù–î ----------

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    chat_id = update.effective_chat.id
    profile = user_profiles.get(chat_id)
    if profile and profile.get("birth"):
        extra = "–Ø —É–∂–µ –∑–Ω–∞—é —Ç–≤–æ—é –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è –∏ —É—á–∏—Ç—ã–≤–∞—é –µ—ë –≤ –ø—Ä–æ–≥–Ω–æ–∑–∞—Ö."
    else:
        extra = (
            "–ß—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –ø—Ä–æ–≥–Ω–æ–∑—ã –±–æ–ª–µ–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º–∏, –æ—Ç–ø—Ä–∞–≤—å –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥–æ–π:\n"
            "`/birth 21.09.1978`"
        )

    text = (
        "–ü—Ä–∏–≤–µ—Ç, —è –û—Ä–∞–∫—É–ª üîÆ\n\n"
        "–Ø –¥–∞—é –º—è–≥–∫–∏–µ, –Ω–æ —Ç–æ—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ –¥–µ–Ω—å –±–µ–∑ —Å–ª–æ–∂–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤.\n\n"
        f"{extra}\n\n"
        "–í—ã–±–µ—Ä–∏, —á—Ç–æ —Ö–æ—á–µ—à—å –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å:\n"
        "‚Äî –æ–±—â–∏–π –ø—Ä–æ–≥–Ω–æ–∑ –¥–Ω—è\n"
        "‚Äî –ª—é–±–æ–≤—å\n"
        "‚Äî –¥–µ–Ω—å–≥–∏\n"
        "‚Äî —Å–æ–≤–µ—Ç\n"
        "‚Äî —ç–Ω–µ—Ä–≥–∏—è –¥–Ω—è\n"
        "‚Äî –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ –Ω–µ–¥–µ–ª—é\n"
    )
    await update.message.reply_markdown(text, reply_markup=main_keyboard())


async def birth(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ö–æ–º–∞–Ω–¥–∞ /birth –î–î.–ú–ú.–ì–ì–ì–ì ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞—Ç—ã —Ä–æ–∂–¥–µ–Ω–∏—è."""
    chat_id = update.effective_chat.id
    args = context.args

    if not args:
        await update.message.reply_text(
            "–û—Ç–ø—Ä–∞–≤—å –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ: /birth 21.09.1978",
            reply_markup=main_keyboard(),
        )
        return

    bdate = parse_birthdate(args[0])
    if not bdate:
        await update.message.reply_text(
            "–ù–µ —Å–º–æ–≥–ª–∞ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –¥–∞—Ç—É. –ü–æ–ø—Ä–æ–±—É–π —Ç–∞–∫: /birth 21.09.1978",
            reply_markup=main_keyboard(),
        )
        return

    user_profiles[chat_id] = {"birth": bdate}
    lp = get_life_path(bdate)

    await update.message.reply_markdown(
        f"–°–æ—Ö—Ä–∞–Ω–∏–ª–∞ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è: *{bdate.strftime('%d.%m.%Y')}*.\n"
        f"–¢–≤–æ—ë –±–∞–∑–æ–≤–æ–µ —á–∏—Å–ª–æ –ø—É—Ç–∏: *{lp}*.\n\n"
        "–¢–µ–ø–µ—Ä—å –ø—Ä–æ–≥–Ω–æ–∑—ã –±—É–¥—É—Ç —Ç–æ—á–Ω–µ–µ –∏ –±–æ–ª—å—à–µ –≤ —Ä–µ–∑–æ–Ω–∞–Ω—Å–µ –∏–º–µ–Ω–Ω–æ —Å —Ç–æ–±–æ–π.",
        reply_markup=main_keyboard(),
    )


def _get_profile_numbers(chat_id: int):
    """–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è: –¥–æ—Å—Ç–∞—ë–º —á–∏—Å–ª–æ –ø—É—Ç–∏, –µ—Å–ª–∏ –µ—Å—Ç—å –¥–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è."""
    profile = user_profiles.get(chat_id)
    if not profile or "birth" not in profile:
        return None
    life_n = get_life_path(profile["birth"])
    return life_n


async def today(update: Update, context: ContextTypes.DEFAULT_TYPE):
    chat_id = update.effective_chat.id
    life_n = _get_profile_numbers(chat_id)
    d = datetime.now().date()
    await update.message.reply_markdown(
        get_general_forecast(d, life_n),
        reply_markup=main_keyboard(),
    )


async def love(update: Update, context: ContextTypes.DEFAULT_TYPE):
    chat_id = update.effective_chat.id
    life_n = _get_profile_numbers(chat_id)
    d = datetime.now().date()
    await update.message.reply_markdown(
        get_love_forecast(d, life_n),
        reply_markup=main_keyboard(),
    )


async def money(update: Update, context: ContextTypes.DEFAULT_TYPE):
    chat_id = update.effective_chat.id
    life_n = _get_profile_numbers(chat_id)
    d = datetime.now().date()
    await update.message.reply_markdown(
        get_money_forecast(d, life_n),
        reply_markup=main_keyboard(),
    )


async def advice(update: Update, context: ContextTypes.DEFAULT_TYPE):
    chat_id = update.effective_chat.id
    life_n = _get_profile_numbers(chat_id)
    d = datetime.now().date()
    await update.message.reply_markdown(
        get_advice(d, life_n),
        reply_markup=main_keyboard(),
    )


async def energy(update: Update, context: ContextTypes.DEFAULT_TYPE):
    chat_id = update.effective_chat.id
    life_n = _get_profile_numbers(chat_id)
    d = datetime.now().date()
    await update.message.reply_markdown(
        get_energy(d, life_n),
        reply_markup=main_keyboard(),
    )


async def week(update: Update, context: ContextTypes.DEFAULT_TYPE):
    chat_id = update.effective_chat.id
    life_n = _get_profile_numbers(chat_id)
    d = datetime.now().date()
    await update.message.reply_markdown(
        get_week_overview(d, life_n),
        reply_markup=main_keyboard(),
    )


# ---------- –û–ë–†–ê–ë–û–¢–ö–ê –ö–ù–û–ü–û–ö (–¢–ï–ö–°–¢–û–í–´–•) ----------

async def handle_buttons(update: Update, context: ContextTypes.DEFAULT_TYPE):
    text = (update.message.text or "").strip()

    if text.startswith("üîÆ"):
        await today(update, context)
    elif text.startswith("üìÖ"):
        await week(update, context)
    elif text.startswith("‚ù§Ô∏è"):
        await love(update, context)
    elif text.startswith("üí∞"):
        await money(update, context)
    elif text.startswith("üí°"):
        await advice(update, context)
    elif text.startswith("‚ú®"):
        await energy(update, context)
    else:
        await update.message.reply_text(
            "–Ø —Ç–µ–±—è —Å–ª—ã—à—É üôÇ –í—ã–±–µ—Ä–∏ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ –∏–ª–∏ –Ω–∞–ø–∏—à–∏ /start, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é.",
            reply_markup=main_keyboard(),
        )


# ---------- –ó–ê–ü–£–°–ö –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ----------

def main():
    token = os.environ.get("TELEGRAM_TOKEN")
    if not token:
        raise ValueError("TELEGRAM_TOKEN –Ω–µ –Ω–∞–π–¥–µ–Ω. –î–æ–±–∞–≤—å –µ–≥–æ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è Render.")

    application = ApplicationBuilder().token(token).build()

    application.add_handler(CommandHandler("start", start))
    application.add_handler(CommandHandler("birth", birth))
    application.add_handler(CommandHandler("today", today))
    application.add_handler(CommandHandler("love", love))
    application.add_handler(CommandHandler("money", money))
    application.add_handler(CommandHandler("advice", advice))
    application.add_handler(CommandHandler("energy", energy))
    application.add_handler(CommandHandler("week", week))

    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_buttons))

    application.run_polling()


if __name__ == "__main__":
    main()
